import{_ as i,c as l,a,b as t,d as s,e as p,w as o,r as c,o as u}from"./app-D3DtFXkQ.js";const r={};function d(k,n){const e=c("RouteLink");return u(),l("div",null,[n[6]||(n[6]=a(`<h1 id="useful-configurations" tabindex="-1"><a class="header-anchor" href="#useful-configurations"><span>Useful Configurations</span></a></h1><p>At the root of your project, you can create <code>ship.config.js</code> file to customize the process.</p><p>Everything is optional.</p><h2 id="monorepo" tabindex="-1"><a class="header-anchor" href="#monorepo"><span>Monorepo</span></a></h2><p>Ship.js currently supports monorepo project(Independent versioning is not supported at the moment).</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">monorepo</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">mainVersionFile</span><span class="token operator">:</span> <span class="token string">&#39;package.json&#39;</span><span class="token punctuation">,</span> <span class="token comment">// or \`lerna.json\`, or whatever a json file you can read the latest \`version\` from.</span></span>
<span class="line">    <span class="token literal-property property">packagesToBump</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;packages/*&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;examples/*&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">packagesToPublish</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;packages/*&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>With the config above, <code>prepare</code> command will</p><ol><li>Read the current version from <code>package.json</code> file at the project root directory.</li><li>Calculate the next version based on commit messages.</li><li>Update the next version over <code>package.json</code> files in <code>[&#39;packages/*&#39;, &#39;examples/*&#39;]</code>.</li></ol><p>And <code>trigger</code> command will publish packages in <code>[&#39;packages/*&#39;]</code>.</p><p>When Ship.js handles <code>packagesToBump</code> and <code>packagesToPublish</code>, it will only list directories with <code>package.json</code> inside them.</p><h2 id="extra-work-on-updating-version" tabindex="-1"><a class="header-anchor" href="#extra-work-on-updating-version"><span>Extra work on updating version</span></a></h2><p>After bumping the version, you may want to do extra work regarding the version. Ship.js provides <code>versionUpdated</code> hook.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function-variable function">versionUpdated</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> version<span class="token punctuation">,</span> releaseType<span class="token punctuation">,</span> dir<span class="token punctuation">,</span> exec <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// update \`lerna.json\`</span></span>
<span class="line">    <span class="token keyword">const</span> lernaConfigPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token string">&#39;lerna.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> lernaConfig <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>lernaConfigPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    lernaConfig<span class="token punctuation">.</span>version <span class="token operator">=</span> version<span class="token punctuation">;</span></span>
<span class="line">    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>lernaConfigPath<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>lernaConfig<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// update \`src/lib/version.js\`</span></span>
<span class="line">    <span class="token keyword">const</span> versionPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token string">&#39;src/lib/version.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>versionPath<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">export default &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;;\\n</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// update dependencies (if you&#39;re using yarn workspace)</span></span>
<span class="line">    <span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">yarn workspace example-foo add my-lib@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">yarn workspace example-bar add my-lib@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="schedule-your-release" tabindex="-1"><a class="header-anchor" href="#schedule-your-release"><span>Schedule your release</span></a></h2><p>At Part 1, by running <code>yarn run release</code>, you get a PR for next release. What if you even automate this?</p><p>You can configure your CI to run periodically <code>yarn run release</code>.</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span></span>
<span class="line"><span class="token key atrule">jobs</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">prepare_release</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">docker</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&#39;circleci/node:latest&#39;</span></span>
<span class="line">    <span class="token key atrule">steps</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> checkout</span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">name</span><span class="token punctuation">:</span> Install</span>
<span class="line">          <span class="token key atrule">command</span><span class="token punctuation">:</span> yarn install</span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">name</span><span class="token punctuation">:</span> Prepare release</span>
<span class="line">          <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">            git config --global user.email &quot;you@example.com&quot;</span>
<span class="line">            git config --global user.name &quot;Your Name&quot;</span>
<span class="line">            yarn run release --yes --no-browse</span></span>
<span class="line"><span class="token key atrule">workflows</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span></span>
<span class="line">  <span class="token key atrule">prepare_release_every_tuesday</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">triggers</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">schedule</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">cron</span><span class="token punctuation">:</span> <span class="token string">&#39;0 9 * * 2&#39;</span></span>
<span class="line">          <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">branches</span><span class="token punctuation">:</span></span>
<span class="line">              <span class="token key atrule">only</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token punctuation">-</span> master</span>
<span class="line">    <span class="token key atrule">jobs</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> prepare_release</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>GITHUB_TOKEN</code> is required for CircleCI to create a PR. Make sure you have it configured as an environment variable.</p><p>Now, every Tuesday at 9am, new PR will be created. All you need to do is review the PR and merge it. Then the rest will be automatically done.</p><p>If you&#39;re using CircleCI v2.0, you can also manually trigger the job using API call. You can refer to <a href="https://circleci.com/docs/2.0/api-job-trigger/" target="_blank" rel="noopener noreferrer">this document</a>, but it won&#39;t work in CircleCI v2.1.</p><h2 id="assign-reviewers" tabindex="-1"><a class="header-anchor" href="#assign-reviewers"><span>Assign Reviewers</span></a></h2><p>You can assign reviewers on the PR.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">pullRequestReviewers</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;user-login1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user-login2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user-login3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line">  <span class="token operator">...</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// also</span></span>
<span class="line">  <span class="token literal-property property">pullRequestTeamReviewers</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;team-slug1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;team-slug2&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>One thing you need to be aware of is, you cannot assign yourself as a reviewer. You can put github username of your team or colleagues. The value can be either a string or an array of strings.</p>`,24)),t("p",null,[n[1]||(n[1]=s("The assignees will receive a notification from GitHub when the PR is created. Whenever they review and merge the PR, it will be automatically released by the prior configuration you've done ",-1)),p(e,{to:"/guide/getting-started.html#automate-part-3-trigger"},{default:o(()=>[...n[0]||(n[0]=[s("here",-1)])]),_:1}),n[2]||(n[2]=s(".",-1))]),n[7]||(n[7]=a(`<h2 id="release-snapshot" tabindex="-1"><a class="header-anchor" href="#release-snapshot"><span>Release Snapshot</span></a></h2><p>If you want to maintain a branch for release snapshot, you can use <code>afterPublish</code> hook.</p><p>For example, you normally work on <code>develop</code> and want to have the latest release at <code>master</code>.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function-variable function">afterPublish</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> exec <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">git config --global user.email &quot;you@example.com&quot;</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">git config --global user.name &quot;Your Name&quot;</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">&#39;git checkout master&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">&#39;git merge develop&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">&#39;git push origin master&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In this way, you can keep <code>master</code> up-to-date with the latest release.</p><div class="hint-container warning"><p class="hint-container-title">NOTICE</p><p>Normally you cannot create commits and push them from your CI service.</p><p>In case of CircleCI, you can read the following document to configure either deploy key or user key to enable it.</p><p><a href="https://circleci.com/docs/2.0/gh-bb-integration/#deployment-keys-and-user-keys" target="_blank" rel="noopener noreferrer">Deployment Keys and User Keys - CircleCI</a></p></div><h2 id="slack-incoming-hook" tabindex="-1"><a class="header-anchor" href="#slack-incoming-hook"><span><code>SLACK_INCOMING_HOOK</code></span></a></h2><p>If you configure an environment variable <code>SLACK_INCOMING_HOOK</code>, Ship.js will send messages</p><ul><li>when <code>shipjs prepare</code> is finished</li><li>when <code>shipjs trigger</code> begins</li><li>when <code>shipjs trigger</code> is finished</li></ul>`,9)),t("p",null,[n[4]||(n[4]=s("You can ",-1)),p(e,{to:"/reference/all-config.html#messaging-to-slack"},{default:o(()=>[...n[3]||(n[3]=[s("read more",-1)])]),_:1}),n[5]||(n[5]=s(" to customize this behavior.",-1))]),n[8]||(n[8]=a(`<h2 id="release-somewhere-else" tabindex="-1"><a class="header-anchor" href="#release-somewhere-else"><span>Release somewhere else</span></a></h2><p>You can use Ship.js to release projects somewhere other than NPM.</p><p>For example,</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function-variable function">publishCommand</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;npx now&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>By default, <code>publishCommand</code> returns <code>npm publish</code>. You can override it like the above to release it to wherever you want.</p><p>If you have configured <code>monorepo</code>, this command will run in each package in <code>monorepo.packagesToPublish</code>.</p>`,6))])}const v=i(r,[["render",d]]),g=JSON.parse('{"path":"/guide/useful-config.html","title":"Useful Configurations","lang":"en-US","frontmatter":{},"git":{"updatedTime":1673275137000,"contributors":[{"name":"Eunjae Lee","username":"","email":"eunjae.lee@algolia.com","commits":7},{"name":"shipjs","username":"shipjs","email":"shipjs@test.com","commits":3,"url":"https://github.com/shipjs"},{"name":"dhayab","username":"dhayab","email":"154633+dhayab@users.noreply.github.com","commits":1,"url":"https://github.com/dhayab"}],"changelog":[{"hash":"1ecca95c902aa4218b20f64b8bc0dfb2cd729ae9","time":1673275137000,"email":"154633+dhayab@users.noreply.github.com","author":"Dhaya","message":"docs: document git user config before trigger workflow (#991)"},{"hash":"66149dc4da2884a57dca03296fbc24262843964a","time":1599564522000,"email":"eunjae.lee@algolia.com","author":"Eunjae Lee","message":"fix(trigger): replace yarn publish with npm publish (#919)","coAuthors":[{"name":"shipjs","email":"shipjs@test.com"}]},{"hash":"7b8b430d73d982ea54c217062aa2db3f284a63d5","time":1591555638000,"email":"eunjae.lee@algolia.com","author":"Eunjae Lee","message":"chore: remove mergeStrategy (#861)","coAuthors":[{"name":"shipjs","email":"shipjs@test.com"}]},{"hash":"f6cb4160f675649ea84c03f63fc31780067dc487","time":1590433887000,"email":"eunjae.lee@algolia.com","author":"Eunjae Lee","message":"docs: update guide on script (#839)"},{"hash":"833d684d516bf75bdc3ae62c634ff1c8b7e3340c","time":1583504397000,"email":"eunjae.lee@algolia.com","author":"Eunjae Lee","message":"fix: clean up reviewer related configs (#707)","coAuthors":[{"name":"shipjs","email":"shipjs@test.com"}]},{"hash":"14ebf3865954c1ca2b07e03cb02dbe3f06f1f593","time":1578994743000,"email":"eunjae.lee@algolia.com","author":"Eunjae Lee","message":"feat(prepare): provide a config to assign team as reviewer (#619)"},{"hash":"c0f1330f6668a21b8807f02960d7dcb5cc41fc8d","time":1577118654000,"email":"eunjae.lee@algolia.com","author":"Eunjae Lee","message":"docs: update useful config regarding slack incoming hook (#551)"},{"hash":"6ddec2f625568e956b0820fac6f770984e52d4a4","time":1575417749000,"email":"eunjae.lee@algolia.com","author":"Eunjae Lee","message":"docs: add website (#397)"}]},"filePathRelative":"guide/useful-config.md"}');export{v as comp,g as data};
